2025-03-01 16:09:04,767 p=697820 u=digitd n=ansible INFO| PLAY [Create directory for storing backups] ******************************************************************************************************************************************************************************************************
2025-03-01 16:09:04,772 p=697820 u=digitd n=ansible INFO| TASK [Create and setup rights] *******************************************************************************************************************************************************************************************************************
2025-03-01 16:09:05,505 p=697820 u=digitd n=ansible INFO| ok: [db.etcd.lan]
2025-03-01 16:09:05,506 p=697820 u=digitd n=ansible INFO| TASK [Create .ssh directory and authorized_keys file] ********************************************************************************************************************************************************************************************
2025-03-01 16:09:05,864 p=697820 u=digitd n=ansible INFO| ok: [db.etcd.lan] => (item={'path': '/var/lib/postgresql/15/data/.ssh', 'state': 'directory', 'mode': '0700'})
2025-03-01 16:09:06,203 p=697820 u=digitd n=ansible INFO| changed: [db.etcd.lan] => (item={'path': '/var/lib/postgresql/15/data/.ssh/authorized_keys', 'state': 'touch', 'mode': '0600'})
2025-03-01 16:09:06,206 p=697820 u=digitd n=ansible INFO| PLAY [Setup pgbackrest (postgres backup tool) on the patroni nodes] ******************************************************************************************************************************************************************************
2025-03-01 16:09:06,229 p=697820 u=digitd n=ansible INFO| TASK [Ensure that pgbackrest package is installed] ***********************************************************************************************************************************************************************************************
2025-03-01 16:09:08,408 p=697820 u=digitd n=ansible INFO| ok: [db.slave.lan]
2025-03-01 16:09:08,583 p=697820 u=digitd n=ansible INFO| ok: [db.master.lan]
2025-03-01 16:09:08,584 p=697820 u=digitd n=ansible INFO| TASK [Copy files to the machines] ****************************************************************************************************************************************************************************************************************
2025-03-01 16:09:09,279 p=697820 u=digitd n=ansible INFO| ok: [db.slave.lan]
2025-03-01 16:09:09,409 p=697820 u=digitd n=ansible INFO| ok: [db.master.lan]
2025-03-01 16:09:09,410 p=697820 u=digitd n=ansible INFO| TASK [Scan sha1-hash] ****************************************************************************************************************************************************************************************************************************
2025-03-01 16:09:10,399 p=697820 u=digitd n=ansible INFO| changed: [db.slave.lan]
2025-03-01 16:09:10,411 p=697820 u=digitd n=ansible INFO| changed: [db.master.lan]
2025-03-01 16:09:10,428 p=697820 u=digitd n=ansible INFO| PLAY [Start backuping] ***************************************************************************************************************************************************************************************************************************
2025-03-01 16:09:10,553 p=697820 u=digitd n=ansible INFO| TASK [Ensure that patroni is running] ************************************************************************************************************************************************************************************************************
2025-03-01 16:09:11,947 p=697820 u=digitd n=ansible INFO| ok: [db.master.lan]
2025-03-01 16:09:11,948 p=697820 u=digitd n=ansible INFO| TASK [Delete stanza] *****************************************************************************************************************************************************************************************************************************
2025-03-01 16:09:13,407 p=697820 u=digitd n=ansible INFO| fatal: [db.master.lan]: FAILED! => {"changed": true, "cmd": ["sudo", "-u", "postgres", "pgbackrest", "--stanza=testcluster", "--log-level-console=info", "--force", "stanza-delete"], "delta": "0:00:01.014150", "end": "2025-03-01 16:09:13.362726", "msg": "non-zero return code", "rc": 55, "start": "2025-03-01 16:09:12.348576", "stderr": "", "stderr_lines": [], "stdout": "2025-03-01 16:09:12.380 P00   INFO: stanza-delete command begin 2.54.2: --exec-id=29358-f6a69abd --force --log-level-console=info --pg1-path=/var/lib/postgresql/15/data --pg1-port=5050 --repo1-cipher-pass=<redacted> --repo1-cipher-type=aes-256-cbc --repo1-path=/mnt/pgbackrest_backups --repo1-sftp-host=db.etcd.lan --repo1-sftp-host-key-hash-type=sha1 --repo1-sftp-host-user=postgres --repo1-sftp-private-key-file=/var/lib/postgresql/.ssh/id_ed25519 --repo1-sftp-public-key-file=/var/lib/postgresql/.ssh/id_ed25519.pub --repo1-type=sftp --stanza=testcluster\n2025-03-01 16:09:13.358 P00  ERROR: [055]: stop file does not exist for stanza 'testcluster'\n                                    HINT: has the pgbackrest stop command been run on this server for this stanza?\n2025-03-01 16:09:13.358 P00   INFO: stanza-delete command end: aborted with exception [055]", "stdout_lines": ["2025-03-01 16:09:12.380 P00   INFO: stanza-delete command begin 2.54.2: --exec-id=29358-f6a69abd --force --log-level-console=info --pg1-path=/var/lib/postgresql/15/data --pg1-port=5050 --repo1-cipher-pass=<redacted> --repo1-cipher-type=aes-256-cbc --repo1-path=/mnt/pgbackrest_backups --repo1-sftp-host=db.etcd.lan --repo1-sftp-host-key-hash-type=sha1 --repo1-sftp-host-user=postgres --repo1-sftp-private-key-file=/var/lib/postgresql/.ssh/id_ed25519 --repo1-sftp-public-key-file=/var/lib/postgresql/.ssh/id_ed25519.pub --repo1-type=sftp --stanza=testcluster", "2025-03-01 16:09:13.358 P00  ERROR: [055]: stop file does not exist for stanza 'testcluster'", "                                    HINT: has the pgbackrest stop command been run on this server for this stanza?", "2025-03-01 16:09:13.358 P00   INFO: stanza-delete command end: aborted with exception [055]"]}
2025-03-01 16:09:13,408 p=697820 u=digitd n=ansible INFO| PLAY RECAP ***************************************************************************************************************************************************************************************************************************************
2025-03-01 16:09:13,526 p=697820 u=digitd n=ansible INFO| db.etcd.lan                : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-01 16:09:13,618 p=697820 u=digitd n=ansible INFO| db.master.lan              : ok=4    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-01 16:09:13,651 p=697820 u=digitd n=ansible INFO| db.slave.lan               : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-01 16:10:45,330 p=701007 u=digitd n=ansible INFO| PLAY [Create directory for storing backups] ******************************************************************************************************************************************************************************************************
2025-03-01 16:10:45,334 p=701007 u=digitd n=ansible INFO| TASK [Create and setup rights] *******************************************************************************************************************************************************************************************************************
2025-03-01 16:10:46,139 p=701007 u=digitd n=ansible INFO| ok: [db.etcd.lan]
2025-03-01 16:10:46,140 p=701007 u=digitd n=ansible INFO| TASK [Create .ssh directory and authorized_keys file] ********************************************************************************************************************************************************************************************
2025-03-01 16:10:46,580 p=701007 u=digitd n=ansible INFO| ok: [db.etcd.lan] => (item={'path': '/var/lib/postgresql/15/data/.ssh', 'state': 'directory', 'mode': '0700'})
2025-03-01 16:10:46,977 p=701007 u=digitd n=ansible INFO| changed: [db.etcd.lan] => (item={'path': '/var/lib/postgresql/15/data/.ssh/authorized_keys', 'state': 'touch', 'mode': '0600'})
2025-03-01 16:10:46,980 p=701007 u=digitd n=ansible INFO| PLAY [Setup pgbackrest (postgres backup tool) on the patroni nodes] ******************************************************************************************************************************************************************************
2025-03-01 16:10:47,012 p=701007 u=digitd n=ansible INFO| TASK [Ensure that pgbackrest package is installed] ***********************************************************************************************************************************************************************************************
2025-03-01 16:10:49,218 p=701007 u=digitd n=ansible INFO| ok: [db.slave.lan]
2025-03-01 16:10:49,527 p=701007 u=digitd n=ansible INFO| ok: [db.master.lan]
2025-03-01 16:10:49,529 p=701007 u=digitd n=ansible INFO| TASK [Copy files to the machines] ****************************************************************************************************************************************************************************************************************
2025-03-01 16:10:50,510 p=701007 u=digitd n=ansible INFO| ok: [db.slave.lan]
2025-03-01 16:10:50,523 p=701007 u=digitd n=ansible INFO| ok: [db.master.lan]
2025-03-01 16:10:50,652 p=701007 u=digitd n=ansible INFO| TASK [Scan sha1-hash] ****************************************************************************************************************************************************************************************************************************
2025-03-01 16:10:51,682 p=701007 u=digitd n=ansible INFO| changed: [db.master.lan]
2025-03-01 16:10:51,685 p=701007 u=digitd n=ansible INFO| changed: [db.slave.lan]
2025-03-01 16:10:51,828 p=701007 u=digitd n=ansible INFO| PLAY [Start backuping] ***************************************************************************************************************************************************************************************************************************
2025-03-01 16:10:51,854 p=701007 u=digitd n=ansible INFO| TASK [Ensure that patroni is running] ************************************************************************************************************************************************************************************************************
2025-03-01 16:10:53,380 p=701007 u=digitd n=ansible INFO| ok: [db.master.lan]
2025-03-01 16:10:53,381 p=701007 u=digitd n=ansible INFO| TASK [Stop stanza] *******************************************************************************************************************************************************************************************************************************
2025-03-01 16:10:53,807 p=701007 u=digitd n=ansible INFO| changed: [db.master.lan]
2025-03-01 16:10:53,808 p=701007 u=digitd n=ansible INFO| TASK [Delete stanza] *****************************************************************************************************************************************************************************************************************************
2025-03-01 16:10:55,549 p=701007 u=digitd n=ansible INFO| changed: [db.master.lan]
2025-03-01 16:10:55,550 p=701007 u=digitd n=ansible INFO| TASK [Create stanza] *****************************************************************************************************************************************************************************************************************************
2025-03-01 16:10:57,149 p=701007 u=digitd n=ansible INFO| changed: [db.master.lan]
2025-03-01 16:10:57,150 p=701007 u=digitd n=ansible INFO| TASK [Check] *************************************************************************************************************************************************************************************************************************************
2025-03-01 16:11:07,136 p=701007 u=digitd n=ansible INFO| changed: [db.master.lan]
2025-03-01 16:11:07,137 p=701007 u=digitd n=ansible INFO| TASK [Print pgbackrest check] ********************************************************************************************************************************************************************************************************************
2025-03-01 16:11:07,309 p=701007 u=digitd n=ansible INFO| ok: [db.master.lan] => {
    "msg": [
        "2025-03-01 16:10:57.529 P00   INFO: check command begin 2.54.2: --exec-id=29971-92d9e6f6 --log-level-console=info --pg1-path=/var/lib/postgresql/15/data --pg1-port=5050 --repo1-cipher-pass=<redacted> --repo1-cipher-type=aes-256-cbc --repo1-path=/mnt/pgbackrest_backups --repo1-sftp-host=db.etcd.lan --repo1-sftp-host-key-hash-type=sha1 --repo1-sftp-host-user=postgres --repo1-sftp-private-key-file=/var/lib/postgresql/.ssh/id_ed25519 --repo1-sftp-public-key-file=/var/lib/postgresql/.ssh/id_ed25519.pub --repo1-type=sftp --stanza=testcluster",
        "2025-03-01 16:10:57.542 P00   INFO: check repo1 configuration (primary)",
        "2025-03-01 16:10:58.359 P00   INFO: check repo1 archive for WAL (primary)",
        "2025-03-01 16:11:07.079 P00   INFO: WAL segment 000000020000000000000004 successfully archived to '/mnt/pgbackrest_backups/archive/testcluster/15-1/0000000200000000/000000020000000000000004-6ab9a52217d35ca0a38c927eaaebfdc41a04211f.gz' on repo1",
        "2025-03-01 16:11:07.079 P00   INFO: check command end: completed successfully (9554ms)"
    ]
}
2025-03-01 16:11:07,384 p=701007 u=digitd n=ansible INFO| TASK [Perform first backup of DB] ****************************************************************************************************************************************************************************************************************
2025-03-01 16:11:20,659 p=701007 u=digitd n=ansible INFO| changed: [db.master.lan]
2025-03-01 16:11:20,661 p=701007 u=digitd n=ansible INFO| TASK [Show info about backups] *******************************************************************************************************************************************************************************************************************
2025-03-01 16:11:21,265 p=701007 u=digitd n=ansible INFO| changed: [db.master.lan]
2025-03-01 16:11:21,266 p=701007 u=digitd n=ansible INFO| TASK [Print it] **********************************************************************************************************************************************************************************************************************************
2025-03-01 16:11:21,500 p=701007 u=digitd n=ansible INFO| ok: [db.master.lan] => {
    "msg": [
        "stanza: testcluster",
        "    status: ok",
        "    cipher: aes-256-cbc",
        "",
        "    db (current)",
        "        wal archive min/max (15): 000000020000000000000004/000000020000000000000006",
        "",
        "        full backup: 20250301-161108F",
        "            timestamp start/stop: 2025-03-01 16:11:08+03 / 2025-03-01 16:11:17+03",
        "            wal start/stop: 000000020000000000000006 / 000000020000000000000006",
        "            database size: 22MB, database backup size: 22MB",
        "            repo1: backup size: 3.0MB"
    ]
}
2025-03-01 16:11:21,600 p=701007 u=digitd n=ansible INFO| TASK [Create cron job for full backup] ***********************************************************************************************************************************************************************************************************
2025-03-01 16:11:22,342 p=701007 u=digitd n=ansible INFO| ok: [db.master.lan]
2025-03-01 16:11:22,343 p=701007 u=digitd n=ansible INFO| TASK [Create cron job for diff backup] ***********************************************************************************************************************************************************************************************************
2025-03-01 16:11:22,843 p=701007 u=digitd n=ansible INFO| ok: [db.master.lan]
2025-03-01 16:11:22,844 p=701007 u=digitd n=ansible INFO| TASK [Create cron job for incr backup] ***********************************************************************************************************************************************************************************************************
2025-03-01 16:11:23,397 p=701007 u=digitd n=ansible INFO| ok: [db.master.lan]
2025-03-01 16:11:23,398 p=701007 u=digitd n=ansible INFO| PLAY RECAP ***************************************************************************************************************************************************************************************************************************************
2025-03-01 16:11:23,574 p=701007 u=digitd n=ansible INFO| db.etcd.lan                : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-01 16:11:23,707 p=701007 u=digitd n=ansible INFO| db.master.lan              : ok=15   changed=7    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-01 16:11:23,849 p=701007 u=digitd n=ansible INFO| db.slave.lan               : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-02 19:26:33,128 p=1039826 u=digitd n=ansible INFO| Using /run/media/digitd/NFS/git/travelata_test/ansible/db_backup_setup/ansible.cfg as config file
2025-03-02 19:26:33,274 p=1039826 u=digitd n=ansible INFO| PLAY [Create directory for storing backups] ******************************************************************************************************************************************************************************************************
2025-03-02 19:26:33,279 p=1039826 u=digitd n=ansible INFO| TASK [Create and setup rights] *******************************************************************************************************************************************************************************************************************
2025-03-02 19:26:35,031 p=1039826 u=digitd n=ansible INFO| ok: [db.etcd.lan] => {"ansible_facts": {"discovered_interpreter_python": "/usr/bin/python3.11"}, "changed": false, "gid": 110, "group": "postgres", "mode": "0764", "owner": "postgres", "path": "/mnt/pgbackrest_backups", "size": 4096, "state": "directory", "uid": 102}
2025-03-02 19:26:35,032 p=1039826 u=digitd n=ansible INFO| TASK [Create .ssh directory and authorized_keys file] ********************************************************************************************************************************************************************************************
2025-03-02 19:26:35,633 p=1039826 u=digitd n=ansible INFO| ok: [db.etcd.lan] => (item={'path': '/var/lib/postgresql/15/data/.ssh', 'state': 'directory', 'mode': '0700'}) => {"ansible_loop_var": "item", "changed": false, "gid": 110, "group": "postgres", "item": {"mode": "0700", "path": "/var/lib/postgresql/15/data/.ssh", "state": "directory"}, "mode": "0700", "owner": "postgres", "path": "/var/lib/postgresql/15/data/.ssh", "size": 4096, "state": "directory", "uid": 102}
2025-03-02 19:26:35,940 p=1039826 u=digitd n=ansible INFO| changed: [db.etcd.lan] => (item={'path': '/var/lib/postgresql/15/data/.ssh/authorized_keys', 'state': 'touch', 'mode': '0600'}) => {"ansible_loop_var": "item", "changed": true, "dest": "/var/lib/postgresql/15/data/.ssh/authorized_keys", "gid": 110, "group": "postgres", "item": {"mode": "0600", "path": "/var/lib/postgresql/15/data/.ssh/authorized_keys", "state": "touch"}, "mode": "0600", "owner": "postgres", "size": 0, "state": "file", "uid": 102}
2025-03-02 19:26:35,943 p=1039826 u=digitd n=ansible INFO| PLAY [Setup pgbackrest (postgres backup tool) on the patroni nodes] ******************************************************************************************************************************************************************************
2025-03-02 19:26:36,019 p=1039826 u=digitd n=ansible INFO| TASK [Ensure that pgbackrest package is installed] ***********************************************************************************************************************************************************************************************
2025-03-02 19:28:06,714 p=1039826 u=digitd n=ansible INFO| ok: [db.slave.lan] => {"ansible_facts": {"discovered_interpreter_python": "/usr/bin/python3.11"}, "cache_update_time": 1740932821, "cache_updated": true, "changed": false}
2025-03-02 19:28:25,680 p=1039826 u=digitd n=ansible INFO| ok: [db.master.lan] => {"ansible_facts": {"discovered_interpreter_python": "/usr/bin/python3.11"}, "cache_update_time": 1740932854, "cache_updated": true, "changed": false}
2025-03-02 19:28:25,682 p=1039826 u=digitd n=ansible INFO| TASK [Copy files to the machines] ****************************************************************************************************************************************************************************************************************
2025-03-02 19:28:28,068 p=1039826 u=digitd n=ansible INFO| ok: [db.slave.lan] => {"changed": false, "checksum": "30b396d562c8f7467d7f0e39915effcb3d989e55", "dest": "/etc/pgbackrest.conf", "gid": 111, "group": "postgres", "mode": "0640", "owner": "postgres", "path": "/etc/pgbackrest.conf", "size": 566, "state": "file", "uid": 103}
2025-03-02 19:28:29,337 p=1039826 u=digitd n=ansible INFO| ok: [db.master.lan] => {"changed": false, "checksum": "30b396d562c8f7467d7f0e39915effcb3d989e55", "dest": "/etc/pgbackrest.conf", "gid": 110, "group": "postgres", "mode": "0640", "owner": "postgres", "path": "/etc/pgbackrest.conf", "size": 566, "state": "file", "uid": 102}
2025-03-02 19:28:29,338 p=1039826 u=digitd n=ansible INFO| TASK [Scan sha1-hash] ****************************************************************************************************************************************************************************************************************************
2025-03-02 19:28:32,328 p=1039826 u=digitd n=ansible INFO| changed: [db.master.lan] => {"changed": true, "cmd": ["sudo", "-u", "postgres", "ssh-keyscan", "-H", "db.etcd.lan", ">>", "/var/lib/postgresql/.ssh/known_hosts"], "delta": "0:00:01.900347", "end": "2025-03-02 19:28:32.271532", "msg": "", "rc": 0, "start": "2025-03-02 19:28:30.371185", "stderr": "getaddrinfo >>: Name or service not known\r\ngetaddrinfo >>: Name or service not known\r\ngetaddrinfo >>: Name or service not known\r\ngetaddrinfo >>: Name or service not known\r\ngetaddrinfo >>: Name or service not known\r\ngetaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known\r\ngetaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known\r\ngetaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known\r\ngetaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known\r\ngetaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known", "stderr_lines": ["getaddrinfo >>: Name or service not known", "getaddrinfo >>: Name or service not known", "getaddrinfo >>: Name or service not known", "getaddrinfo >>: Name or service not known", "getaddrinfo >>: Name or service not known", "getaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known", "getaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known", "getaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known", "getaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known", "getaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known"], "stdout": "# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5\n# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5\n|1|h3pgT75rmwvSgqXwVMaazbR72oc=|PbgW7lH978irjX2oWSz75+b4eoM= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBN0skod/ZCxD3lltYw6hNIrGwdY2fpKwhnmxWL3Zs9JWXPGf4kaUxp40PAFr8npVzyuNNe94fzpzkym5zfiEp2E=\n# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5\n|1|2zunjW375TPS/wNdgaXILXDF5sE=|UOKYhUofvqfLJC7rTWalqYVL1Vg= ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIL/ZaaTZgBm91hbmIrW7xo4q28fr4Cg6DCQwx/JJT3On\n# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5\n# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5\n|1|HXEHU3bcyg0VuJBQ05e2rxeUwag=|IkNMQv8fLkH7+L9ON/lNJVrd8G8= ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCYYtwr+bKyS0H5pOMJsfddOblcEno3Ir8wPO/Qaiyu0LwmK6eRfnoEo6NgXCCNGM0PgcLIVuUMIImS7x6Htyh2EBYNkJwWmSy90ol5sUX7AdiploT+xxg7kA65MEE4tU+FtVyYygvd0mnSlQsUVXRL+w82sCLsC7ufpmBX2LQDiUhqjFvNRuIyfm4PH+e06mYqOT3h+9bIFLrIuGBLEWLtbl488nAmBtzzn6ahvctrvYPrH0W0jlpM7Qk69LMz8156aZHTot9LIVotZlnqSmxV41I2E4Y/VGuAVavbicKg4JqimU9kSJz7pNRZb771pDU4QBJxeRXipWXDWsVOkL3wZPsjWDKDfqW5aQERWITCQ0inhjO/H993zgMTqVGlbJeCvwakCe0F0y1/js7iGe8ZaH6IwQpp46sgg4cad9itdWejjPrgsLx8HE7f6Eo9Ue2S7OZhIp6vN6PWIUX+e/ARq4Qebyl3quCku0ZVAXgi4aH5c0Kc3niPAOc5hT/jM9c=", "stdout_lines": ["# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5", "# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5", "|1|h3pgT75rmwvSgqXwVMaazbR72oc=|PbgW7lH978irjX2oWSz75+b4eoM= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBN0skod/ZCxD3lltYw6hNIrGwdY2fpKwhnmxWL3Zs9JWXPGf4kaUxp40PAFr8npVzyuNNe94fzpzkym5zfiEp2E=", "# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5", "|1|2zunjW375TPS/wNdgaXILXDF5sE=|UOKYhUofvqfLJC7rTWalqYVL1Vg= ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIL/ZaaTZgBm91hbmIrW7xo4q28fr4Cg6DCQwx/JJT3On", "# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5", "# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5", "|1|HXEHU3bcyg0VuJBQ05e2rxeUwag=|IkNMQv8fLkH7+L9ON/lNJVrd8G8= ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCYYtwr+bKyS0H5pOMJsfddOblcEno3Ir8wPO/Qaiyu0LwmK6eRfnoEo6NgXCCNGM0PgcLIVuUMIImS7x6Htyh2EBYNkJwWmSy90ol5sUX7AdiploT+xxg7kA65MEE4tU+FtVyYygvd0mnSlQsUVXRL+w82sCLsC7ufpmBX2LQDiUhqjFvNRuIyfm4PH+e06mYqOT3h+9bIFLrIuGBLEWLtbl488nAmBtzzn6ahvctrvYPrH0W0jlpM7Qk69LMz8156aZHTot9LIVotZlnqSmxV41I2E4Y/VGuAVavbicKg4JqimU9kSJz7pNRZb771pDU4QBJxeRXipWXDWsVOkL3wZPsjWDKDfqW5aQERWITCQ0inhjO/H993zgMTqVGlbJeCvwakCe0F0y1/js7iGe8ZaH6IwQpp46sgg4cad9itdWejjPrgsLx8HE7f6Eo9Ue2S7OZhIp6vN6PWIUX+e/ARq4Qebyl3quCku0ZVAXgi4aH5c0Kc3niPAOc5hT/jM9c="]}
2025-03-02 19:28:32,341 p=1039826 u=digitd n=ansible INFO| changed: [db.slave.lan] => {"changed": true, "cmd": ["sudo", "-u", "postgres", "ssh-keyscan", "-H", "db.etcd.lan", ">>", "/var/lib/postgresql/.ssh/known_hosts"], "delta": "0:00:01.921103", "end": "2025-03-02 19:28:32.291061", "msg": "", "rc": 0, "start": "2025-03-02 19:28:30.369958", "stderr": "getaddrinfo >>: Name or service not known\r\ngetaddrinfo >>: Name or service not known\r\ngetaddrinfo >>: Name or service not known\r\ngetaddrinfo >>: Name or service not known\r\ngetaddrinfo >>: Name or service not known\r\ngetaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known\r\ngetaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known\r\ngetaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known\r\ngetaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known\r\ngetaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known", "stderr_lines": ["getaddrinfo >>: Name or service not known", "getaddrinfo >>: Name or service not known", "getaddrinfo >>: Name or service not known", "getaddrinfo >>: Name or service not known", "getaddrinfo >>: Name or service not known", "getaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known", "getaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known", "getaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known", "getaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known", "getaddrinfo /var/lib/postgresql/.ssh/known_hosts: Name or service not known"], "stdout": "# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5\n|1|vgCKYfb+mMBHrS/syCOhvY8x5Is=|PHEfprYwYyhgQVQ2CSkmtjnEH+0= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBN0skod/ZCxD3lltYw6hNIrGwdY2fpKwhnmxWL3Zs9JWXPGf4kaUxp40PAFr8npVzyuNNe94fzpzkym5zfiEp2E=\n# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5\n|1|awORgP+0oC0D/bOzg6g2CtZiuGA=|yBUq1Ov9baIygk5RNAEIPgMPUqU= ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCYYtwr+bKyS0H5pOMJsfddOblcEno3Ir8wPO/Qaiyu0LwmK6eRfnoEo6NgXCCNGM0PgcLIVuUMIImS7x6Htyh2EBYNkJwWmSy90ol5sUX7AdiploT+xxg7kA65MEE4tU+FtVyYygvd0mnSlQsUVXRL+w82sCLsC7ufpmBX2LQDiUhqjFvNRuIyfm4PH+e06mYqOT3h+9bIFLrIuGBLEWLtbl488nAmBtzzn6ahvctrvYPrH0W0jlpM7Qk69LMz8156aZHTot9LIVotZlnqSmxV41I2E4Y/VGuAVavbicKg4JqimU9kSJz7pNRZb771pDU4QBJxeRXipWXDWsVOkL3wZPsjWDKDfqW5aQERWITCQ0inhjO/H993zgMTqVGlbJeCvwakCe0F0y1/js7iGe8ZaH6IwQpp46sgg4cad9itdWejjPrgsLx8HE7f6Eo9Ue2S7OZhIp6vN6PWIUX+e/ARq4Qebyl3quCku0ZVAXgi4aH5c0Kc3niPAOc5hT/jM9c=\n# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5\n|1|ONorfpl1v59eJTddsbyAWfkJss4=|aFGvfIICnCBwNaQvTjz9tWlVMmo= ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIL/ZaaTZgBm91hbmIrW7xo4q28fr4Cg6DCQwx/JJT3On\n# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5\n# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5", "stdout_lines": ["# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5", "|1|vgCKYfb+mMBHrS/syCOhvY8x5Is=|PHEfprYwYyhgQVQ2CSkmtjnEH+0= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBN0skod/ZCxD3lltYw6hNIrGwdY2fpKwhnmxWL3Zs9JWXPGf4kaUxp40PAFr8npVzyuNNe94fzpzkym5zfiEp2E=", "# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5", "|1|awORgP+0oC0D/bOzg6g2CtZiuGA=|yBUq1Ov9baIygk5RNAEIPgMPUqU= ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCYYtwr+bKyS0H5pOMJsfddOblcEno3Ir8wPO/Qaiyu0LwmK6eRfnoEo6NgXCCNGM0PgcLIVuUMIImS7x6Htyh2EBYNkJwWmSy90ol5sUX7AdiploT+xxg7kA65MEE4tU+FtVyYygvd0mnSlQsUVXRL+w82sCLsC7ufpmBX2LQDiUhqjFvNRuIyfm4PH+e06mYqOT3h+9bIFLrIuGBLEWLtbl488nAmBtzzn6ahvctrvYPrH0W0jlpM7Qk69LMz8156aZHTot9LIVotZlnqSmxV41I2E4Y/VGuAVavbicKg4JqimU9kSJz7pNRZb771pDU4QBJxeRXipWXDWsVOkL3wZPsjWDKDfqW5aQERWITCQ0inhjO/H993zgMTqVGlbJeCvwakCe0F0y1/js7iGe8ZaH6IwQpp46sgg4cad9itdWejjPrgsLx8HE7f6Eo9Ue2S7OZhIp6vN6PWIUX+e/ARq4Qebyl3quCku0ZVAXgi4aH5c0Kc3niPAOc5hT/jM9c=", "# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5", "|1|ONorfpl1v59eJTddsbyAWfkJss4=|aFGvfIICnCBwNaQvTjz9tWlVMmo= ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIL/ZaaTZgBm91hbmIrW7xo4q28fr4Cg6DCQwx/JJT3On", "# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5", "# db.etcd.lan:22 SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5"]}
2025-03-02 19:28:32,434 p=1039826 u=digitd n=ansible INFO| PLAY [Start backuping] ***************************************************************************************************************************************************************************************************************************
2025-03-02 19:28:32,526 p=1039826 u=digitd n=ansible INFO| TASK [Ensure that patroni is running] ************************************************************************************************************************************************************************************************************
2025-03-02 19:28:34,336 p=1039826 u=digitd n=ansible INFO| ok: [db.master.lan] => {"changed": false, "enabled": true, "name": "patroni", "state": "started", "status": {"ActiveEnterTimestamp": "Sun 2025-03-02 19:04:47 MSK", "ActiveEnterTimestampMonotonic": "110133748153", "ActiveExitTimestamp": "Sun 2025-03-02 19:04:41 MSK", "ActiveExitTimestampMonotonic": "110127841883", "ActiveState": "active", "After": "system.slice network.target systemd-journald.socket basic.target sysinit.target", "AllowIsolate": "no", "AssertResult": "yes", "AssertTimestamp": "Sun 2025-03-02 19:04:47 MSK", "AssertTimestampMonotonic": "110133745514", "Before": "multi-user.target shutdown.target", "BindLogSockets": "no", "BlockIOAccounting": "no", "BlockIOWeight": "[not set]", "CPUAccounting": "yes", "CPUAffinityFromNUMA": "no", "CPUQuotaPerSecUSec": "infinity", "CPUQuotaPeriodUSec": "infinity", "CPUSchedulingPolicy": "0", "CPUSchedulingPriority": "0", "CPUSchedulingResetOnFork": "no", "CPUShares": "[not set]", "CPUUsageNSec": "15089661000", "CPUWeight": "[not set]", "CacheDirectoryMode": "0755", "CanFreeze": "yes", "CanIsolate": "no", "CanLiveMount": "no", "CanReload": "yes", "CanStart": "yes", "CanStop": "yes", "CapabilityBoundingSet": "cap_chown cap_dac_override cap_dac_read_search cap_fowner cap_fsetid cap_kill cap_setgid cap_setuid cap_setpcap cap_linux_immutable cap_net_bind_service cap_net_broadcast cap_net_admin cap_net_raw cap_ipc_lock cap_ipc_owner cap_sys_module cap_sys_rawio cap_sys_chroot cap_sys_ptrace cap_sys_pacct cap_sys_admin cap_sys_boot cap_sys_nice cap_sys_resource cap_sys_time cap_sys_tty_config cap_mknod cap_lease cap_audit_write cap_audit_control cap_setfcap cap_mac_override cap_mac_admin cap_syslog cap_wake_alarm cap_block_suspend cap_audit_read cap_perfmon cap_bpf cap_checkpoint_restore", "CleanResult": "success", "CollectMode": "inactive", "ConditionResult": "yes", "ConditionTimestamp": "Sun 2025-03-02 19:04:47 MSK", "ConditionTimestampMonotonic": "110133745484", "ConfigurationDirectoryMode": "0755", "Conflicts": "shutdown.target", "ControlGroup": "/system.slice/patroni.service", "ControlGroupId": "34411", "ControlPID": "0", "CoredumpFilter": "0x33", "CoredumpReceive": "no", "DebugInvocation": "no", "DefaultDependencies": "yes", "DefaultMemoryLow": "0", "DefaultMemoryMin": "0", "DefaultStartupMemoryLow": "0", "Delegate": "no", "Description": "Runners to orchestrate a high-availability PostgreSQL", "DevicePolicy": "auto", "DynamicUser": "no", "EffectiveMemoryHigh": "2069450752", "EffectiveMemoryMax": "2069450752", "EffectiveTasksMax": "2305", "EnvironmentFiles": "/etc/patroni_env.conf (ignore_errors=yes)", "ExecMainCode": "0", "ExecMainExitTimestampMonotonic": "0", "ExecMainHandoffTimestamp": "Sun 2025-03-02 19:04:47 MSK", "ExecMainHandoffTimestampMonotonic": "110133776729", "ExecMainPID": "218557", "ExecMainStartTimestamp": "Sun 2025-03-02 19:04:47 MSK", "ExecMainStartTimestampMonotonic": "110133746972", "ExecMainStatus": "0", "ExecReload": "{ path=/bin/kill ; argv[]=/bin/kill -s HUP $MAINPID ; ignore_errors=no ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }", "ExecReloadEx": "{ path=/bin/kill ; argv[]=/bin/kill -s HUP $MAINPID ; flags= ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }", "ExecStart": "{ path=/usr/bin/patroni ; argv[]=/usr/bin/patroni /etc/patroni/config.yml ; ignore_errors=no ; start_time=[Sun 2025-03-02 19:04:47 MSK] ; stop_time=[n/a] ; pid=218557 ; code=(null) ; status=0/0 }", "ExecStartEx": "{ path=/usr/bin/patroni ; argv[]=/usr/bin/patroni /etc/patroni/config.yml ; flags= ; start_time=[Sun 2025-03-02 19:04:47 MSK] ; stop_time=[n/a] ; pid=218557 ; code=(null) ; status=0/0 }", "ExitType": "main", "ExtensionImagePolicy": "root=verity+signed+encrypted+unprotected+absent:usr=verity+signed+encrypted+unprotected+absent:home=encrypted+unprotected+absent:srv=encrypted+unprotected+absent:tmp=encrypted+unprotected+absent:var=encrypted+unprotected+absent", "FailureAction": "none", "FileDescriptorStoreMax": "0", "FileDescriptorStorePreserve": "restart", "FinalKillSignal": "9", "FragmentPath": "/usr/lib/systemd/system/patroni.service", "FreezerState": "running", "GID": "110", "Group": "postgres", "GuessMainPID": "yes", "IOAccounting": "no", "IOReadBytes": "[not set]", "IOReadOperations": "[not set]", "IOSchedulingClass": "2", "IOSchedulingPriority": "4", "IOWeight": "[not set]", "IOWriteBytes": "[not set]", "IOWriteOperations": "[not set]", "IPAccounting": "no", "IPEgressBytes": "[no data]", "IPEgressPackets": "[no data]", "IPIngressBytes": "[no data]", "IPIngressPackets": "[no data]", "Id": "patroni.service", "IgnoreOnIsolate": "no", "IgnoreSIGPIPE": "yes", "InactiveEnterTimestamp": "Sun 2025-03-02 19:04:41 MSK", "InactiveEnterTimestampMonotonic": "110127919848", "InactiveExitTimestamp": "Sun 2025-03-02 19:04:47 MSK", "InactiveExitTimestampMonotonic": "110133748153", "InvocationID": "7dde2343960f4ae085eac8b6674db2df", "JobRunningTimeoutUSec": "infinity", "JobTimeoutAction": "none", "JobTimeoutUSec": "infinity", "KeyringMode": "private", "KillMode": "process", "KillSignal": "15", "LimitAS": "infinity", "LimitASSoft": "infinity", "LimitCORE": "infinity", "LimitCORESoft": "0", "LimitCPU": "infinity", "LimitCPUSoft": "infinity", "LimitDATA": "infinity", "LimitDATASoft": "infinity", "LimitFSIZE": "infinity", "LimitFSIZESoft": "infinity", "LimitLOCKS": "infinity", "LimitLOCKSSoft": "infinity", "LimitMEMLOCK": "8388608", "LimitMEMLOCKSoft": "8388608", "LimitMSGQUEUE": "819200", "LimitMSGQUEUESoft": "819200", "LimitNICE": "0", "LimitNICESoft": "0", "LimitNOFILE": "524288", "LimitNOFILESoft": "1024", "LimitNPROC": "7685", "LimitNPROCSoft": "7685", "LimitRSS": "infinity", "LimitRSSSoft": "infinity", "LimitRTPRIO": "0", "LimitRTPRIOSoft": "0", "LimitRTTIME": "infinity", "LimitRTTIMESoft": "infinity", "LimitSIGPENDING": "7685", "LimitSIGPENDINGSoft": "7685", "LimitSTACK": "infinity", "LimitSTACKSoft": "8388608", "LiveMountResult": "success", "LoadState": "loaded", "LockPersonality": "no", "LogLevelMax": "-1", "LogRateLimitBurst": "0", "LogRateLimitIntervalUSec": "0", "LogsDirectoryMode": "0755", "MainPID": "218557", "ManagedOOMMemoryPressure": "auto", "ManagedOOMMemoryPressureDurationUSec": "[not set]", "ManagedOOMMemoryPressureLimit": "0", "ManagedOOMPreference": "none", "ManagedOOMSwap": "auto", "MemoryAccounting": "yes", "MemoryAvailable": "1532416000", "MemoryCurrent": "153661440", "MemoryDenyWriteExecute": "no", "MemoryHigh": "infinity", "MemoryKSM": "no", "MemoryLimit": "infinity", "MemoryLow": "0", "MemoryMax": "infinity", "MemoryMin": "0", "MemoryPeak": "221081600", "MemoryPressureThresholdUSec": "200ms", "MemoryPressureWatch": "auto", "MemorySwapCurrent": "0", "MemorySwapMax": "infinity", "MemorySwapPeak": "0", "MemoryZSwapCurrent": "0", "MemoryZSwapMax": "infinity", "MemoryZSwapWriteback": "yes", "MountAPIVFS": "no", "MountImagePolicy": "root=verity+signed+encrypted+unprotected+absent:usr=verity+signed+encrypted+unprotected+absent:home=encrypted+unprotected+absent:srv=encrypted+unprotected+absent:tmp=encrypted+unprotected+absent:var=encrypted+unprotected+absent", "NFileDescriptorStore": "0", "NRestarts": "0", "NUMAPolicy": "n/a", "Names": "patroni.service", "NeedDaemonReload": "no", "Nice": "0", "NoNewPrivileges": "no", "NonBlocking": "no", "NotifyAccess": "none", "OOMPolicy": "stop", "OOMScoreAdjust": "0", "OnFailureJobMode": "replace", "OnSuccessJobMode": "fail", "Perpetual": "no", "PrivateDevices": "no", "PrivateIPC": "no", "PrivateMounts": "no", "PrivateNetwork": "no", "PrivatePIDs": "no", "PrivateTmp": "no", "PrivateTmpEx": "no", "PrivateUsers": "no", "PrivateUsersEx": "no", "ProcSubset": "all", "ProtectClock": "no", "ProtectControlGroups": "no", "ProtectControlGroupsEx": "no", "ProtectHome": "no", "ProtectHostname": "no", "ProtectKernelLogs": "no", "ProtectKernelModules": "no", "ProtectKernelTunables": "no", "ProtectProc": "default", "ProtectSystem": "no", "RefuseManualStart": "no", "RefuseManualStop": "no", "ReloadResult": "success", "ReloadSignal": "1", "RemainAfterExit": "no", "RemoveIPC": "no", "Requires": "system.slice sysinit.target", "Restart": "on-failure", "RestartKillSignal": "15", "RestartMaxDelayUSec": "infinity", "RestartMode": "normal", "RestartSteps": "0", "RestartUSec": "100ms", "RestartUSecNext": "100ms", "RestrictNamespaces": "no", "RestrictRealtime": "no", "RestrictSUIDSGID": "no", "Result": "success", "RootDirectoryStartOnly": "no", "RootEphemeral": "no", "RootImagePolicy": "root=verity+signed+encrypted+unprotected+absent:usr=verity+signed+encrypted+unprotected+absent:home=encrypted+unprotected+absent:srv=encrypted+unprotected+absent:tmp=encrypted+unprotected+absent:var=encrypted+unprotected+absent", "RuntimeDirectoryMode": "0755", "RuntimeDirectoryPreserve": "no", "RuntimeMaxUSec": "infinity", "RuntimeRandomizedExtraUSec": "0", "SameProcessGroup": "no", "SecureBits": "0", "SendSIGHUP": "no", "SendSIGKILL": "yes", "SetLoginEnvironment": "yes", "Slice": "system.slice", "StandardError": "inherit", "StandardInput": "null", "StandardOutput": "journal", "StartLimitAction": "none", "StartLimitBurst": "5", "StartLimitIntervalUSec": "10s", "StartupBlockIOWeight": "[not set]", "StartupCPUShares": "[not set]", "StartupCPUWeight": "[not set]", "StartupIOWeight": "[not set]", "StartupMemoryHigh": "infinity", "StartupMemoryLow": "0", "StartupMemoryMax": "infinity", "StartupMemorySwapMax": "infinity", "StartupMemoryZSwapMax": "infinity", "StateChangeTimestamp": "Sun 2025-03-02 19:04:47 MSK", "StateChangeTimestampMonotonic": "110133748153", "StateDirectoryMode": "0755", "StatusErrno": "0", "StopWhenUnneeded": "no", "SubState": "running", "SuccessAction": "none", "SurviveFinalKillSignal": "no", "SyslogFacility": "3", "SyslogLevel": "6", "SyslogLevelPrefix": "yes", "SyslogPriority": "30", "SystemCallErrorNumber": "2147483646", "TTYReset": "no", "TTYVHangup": "no", "TTYVTDisallocate": "no", "TasksAccounting": "yes", "TasksCurrent": "16", "TasksMax": "2305", "TimeoutAbortUSec": "30s", "TimeoutCleanUSec": "infinity", "TimeoutStartFailureMode": "terminate", "TimeoutStartUSec": "30s", "TimeoutStopFailureMode": "terminate", "TimeoutStopUSec": "30s", "TimerSlackNSec": "50000", "Transient": "no", "Type": "simple", "UID": "102", "UMask": "0022", "UnitFilePreset": "enabled", "UnitFileState": "enabled", "User": "postgres", "UtmpMode": "init", "WantedBy": "multi-user.target", "WatchdogSignal": "6", "WatchdogTimestampMonotonic": "0", "WatchdogUSec": "0"}}
2025-03-02 19:28:34,337 p=1039826 u=digitd n=ansible INFO| TASK [Create stanza] *****************************************************************************************************************************************************************************************************************************
2025-03-02 19:28:35,476 p=1039826 u=digitd n=ansible INFO| changed: [db.master.lan] => {"changed": true, "cmd": ["sudo", "-u", "postgres", "pgbackrest", "--stanza=testcluster", "--log-level-console=info", "stanza-create"], "delta": "0:00:00.741775", "end": "2025-03-02 19:28:35.415886", "msg": "", "rc": 0, "start": "2025-03-02 19:28:34.674111", "stderr": "", "stderr_lines": [], "stdout": "2025-03-02 19:28:34.704 P00   INFO: stanza-create command begin 2.54.2: --exec-id=223465-1411d358 --log-level-console=info --pg1-path=/var/lib/postgresql/15/data --pg1-port=5050 --repo1-cipher-pass=<redacted> --repo1-cipher-type=aes-256-cbc --repo1-path=/mnt/pgbackrest_backups --repo1-sftp-host=db.etcd.lan --repo1-sftp-host-key-hash-type=sha1 --repo1-sftp-host-user=postgres --repo1-sftp-private-key-file=/var/lib/postgresql/.ssh/id_ed25519 --repo1-sftp-public-key-file=/var/lib/postgresql/.ssh/id_ed25519.pub --repo1-type=sftp --stanza=testcluster\n2025-03-02 19:28:34.802 P00   INFO: stanza-create for stanza 'testcluster' on repo1\n2025-03-02 19:28:35.411 P00   INFO: stanza 'testcluster' already exists on repo1 and is valid\n2025-03-02 19:28:35.411 P00   INFO: stanza-create command end: completed successfully (710ms)", "stdout_lines": ["2025-03-02 19:28:34.704 P00   INFO: stanza-create command begin 2.54.2: --exec-id=223465-1411d358 --log-level-console=info --pg1-path=/var/lib/postgresql/15/data --pg1-port=5050 --repo1-cipher-pass=<redacted> --repo1-cipher-type=aes-256-cbc --repo1-path=/mnt/pgbackrest_backups --repo1-sftp-host=db.etcd.lan --repo1-sftp-host-key-hash-type=sha1 --repo1-sftp-host-user=postgres --repo1-sftp-private-key-file=/var/lib/postgresql/.ssh/id_ed25519 --repo1-sftp-public-key-file=/var/lib/postgresql/.ssh/id_ed25519.pub --repo1-type=sftp --stanza=testcluster", "2025-03-02 19:28:34.802 P00   INFO: stanza-create for stanza 'testcluster' on repo1", "2025-03-02 19:28:35.411 P00   INFO: stanza 'testcluster' already exists on repo1 and is valid", "2025-03-02 19:28:35.411 P00   INFO: stanza-create command end: completed successfully (710ms)"]}
2025-03-02 19:28:35,476 p=1039826 u=digitd n=ansible INFO| TASK [Check] *************************************************************************************************************************************************************************************************************************************
2025-03-02 19:28:37,498 p=1039826 u=digitd n=ansible INFO| changed: [db.master.lan] => {"changed": true, "cmd": ["sudo", "-u", "postgres", "pgbackrest", "--stanza=testcluster", "--log-level-console=info", "check"], "delta": "0:00:01.620668", "end": "2025-03-02 19:28:37.439785", "msg": "", "rc": 0, "start": "2025-03-02 19:28:35.819117", "stderr": "", "stderr_lines": [], "stdout": "2025-03-02 19:28:35.849 P00   INFO: check command begin 2.54.2: --exec-id=223489-a3afa975 --log-level-console=info --pg1-path=/var/lib/postgresql/15/data --pg1-port=5050 --repo1-cipher-pass=<redacted> --repo1-cipher-type=aes-256-cbc --repo1-path=/mnt/pgbackrest_backups --repo1-sftp-host=db.etcd.lan --repo1-sftp-host-key-hash-type=sha1 --repo1-sftp-host-user=postgres --repo1-sftp-private-key-file=/var/lib/postgresql/.ssh/id_ed25519 --repo1-sftp-public-key-file=/var/lib/postgresql/.ssh/id_ed25519.pub --repo1-type=sftp --stanza=testcluster\n2025-03-02 19:28:35.866 P00   INFO: check repo1 configuration (primary)\n2025-03-02 19:28:36.288 P00   INFO: check repo1 archive for WAL (primary)\n2025-03-02 19:28:37.431 P00   INFO: WAL segment 000000010000000000000007 successfully archived to '/mnt/pgbackrest_backups/archive/testcluster/15-1/0000000100000000/000000010000000000000007-56e3315799510cf201fac075cf1edee6ba855093.gz' on repo1\n2025-03-02 19:28:37.432 P00   INFO: check command end: completed successfully (1586ms)", "stdout_lines": ["2025-03-02 19:28:35.849 P00   INFO: check command begin 2.54.2: --exec-id=223489-a3afa975 --log-level-console=info --pg1-path=/var/lib/postgresql/15/data --pg1-port=5050 --repo1-cipher-pass=<redacted> --repo1-cipher-type=aes-256-cbc --repo1-path=/mnt/pgbackrest_backups --repo1-sftp-host=db.etcd.lan --repo1-sftp-host-key-hash-type=sha1 --repo1-sftp-host-user=postgres --repo1-sftp-private-key-file=/var/lib/postgresql/.ssh/id_ed25519 --repo1-sftp-public-key-file=/var/lib/postgresql/.ssh/id_ed25519.pub --repo1-type=sftp --stanza=testcluster", "2025-03-02 19:28:35.866 P00   INFO: check repo1 configuration (primary)", "2025-03-02 19:28:36.288 P00   INFO: check repo1 archive for WAL (primary)", "2025-03-02 19:28:37.431 P00   INFO: WAL segment 000000010000000000000007 successfully archived to '/mnt/pgbackrest_backups/archive/testcluster/15-1/0000000100000000/000000010000000000000007-56e3315799510cf201fac075cf1edee6ba855093.gz' on repo1", "2025-03-02 19:28:37.432 P00   INFO: check command end: completed successfully (1586ms)"]}
2025-03-02 19:28:37,499 p=1039826 u=digitd n=ansible INFO| TASK [Print pgbackrest check] ********************************************************************************************************************************************************************************************************************
2025-03-02 19:28:37,932 p=1039826 u=digitd n=ansible INFO| ok: [db.master.lan] => {
    "msg": [
        "2025-03-02 19:28:35.849 P00   INFO: check command begin 2.54.2: --exec-id=223489-a3afa975 --log-level-console=info --pg1-path=/var/lib/postgresql/15/data --pg1-port=5050 --repo1-cipher-pass=<redacted> --repo1-cipher-type=aes-256-cbc --repo1-path=/mnt/pgbackrest_backups --repo1-sftp-host=db.etcd.lan --repo1-sftp-host-key-hash-type=sha1 --repo1-sftp-host-user=postgres --repo1-sftp-private-key-file=/var/lib/postgresql/.ssh/id_ed25519 --repo1-sftp-public-key-file=/var/lib/postgresql/.ssh/id_ed25519.pub --repo1-type=sftp --stanza=testcluster",
        "2025-03-02 19:28:35.866 P00   INFO: check repo1 configuration (primary)",
        "2025-03-02 19:28:36.288 P00   INFO: check repo1 archive for WAL (primary)",
        "2025-03-02 19:28:37.431 P00   INFO: WAL segment 000000010000000000000007 successfully archived to '/mnt/pgbackrest_backups/archive/testcluster/15-1/0000000100000000/000000010000000000000007-56e3315799510cf201fac075cf1edee6ba855093.gz' on repo1",
        "2025-03-02 19:28:37.432 P00   INFO: check command end: completed successfully (1586ms)"
    ]
}
2025-03-02 19:28:38,208 p=1039826 u=digitd n=ansible INFO| TASK [Perform first backup of DB] ****************************************************************************************************************************************************************************************************************
2025-03-02 19:28:57,528 p=1039826 u=digitd n=ansible INFO| changed: [db.master.lan] => {"changed": true, "cmd": ["sudo", "-u", "postgres", "pgbackrest", "--stanza=testcluster", "--log-level-console=info", "backup"], "delta": "0:00:18.604292", "end": "2025-03-02 19:28:57.467554", "msg": "", "rc": 0, "start": "2025-03-02 19:28:38.863262", "stderr": "", "stderr_lines": [], "stdout": "2025-03-02 19:28:38.895 P00   INFO: backup command begin 2.54.2: --exec-id=223520-c7b6d892 --log-level-console=info --pg1-path=/var/lib/postgresql/15/data --pg1-port=5050 --process-max=4 --repo1-block --repo1-bundle --repo1-cipher-pass=<redacted> --repo1-cipher-type=aes-256-cbc --repo1-path=/mnt/pgbackrest_backups --repo1-retention-diff=2 --repo1-retention-full=2 --repo1-sftp-host=db.etcd.lan --repo1-sftp-host-key-hash-type=sha1 --repo1-sftp-host-user=postgres --repo1-sftp-private-key-file=/var/lib/postgresql/.ssh/id_ed25519 --repo1-sftp-public-key-file=/var/lib/postgresql/.ssh/id_ed25519.pub --repo1-type=sftp --stanza=testcluster --start-fast\n2025-03-02 19:28:39.604 P00   INFO: last backup label = 20250302-192424F, version = 2.54.2\n2025-03-02 19:28:39.604 P00   INFO: execute non-exclusive backup start: backup begins after the requested immediate checkpoint completes\n2025-03-02 19:28:52.381 P00   INFO: backup start archive = 000000010000000000000009, lsn = 0/9000028\n2025-03-02 19:28:52.381 P00   INFO: check archive for prior segment 000000010000000000000008\n2025-03-02 19:28:54.248 P00   INFO: execute non-exclusive backup stop and wait for all WAL segments to archive\n2025-03-02 19:28:54.624 P00   INFO: backup stop archive = 000000010000000000000009, lsn = 0/9000100\n2025-03-02 19:28:54.875 P00   INFO: check archive for segment(s) 000000010000000000000009:000000010000000000000009\n2025-03-02 19:28:55.530 P00   INFO: new backup label = 20250302-192424F_20250302-192839I\n2025-03-02 19:28:57.432 P00   INFO: incr backup size = 8.3KB, file total = 970\n2025-03-02 19:28:57.432 P00   INFO: backup command end: completed successfully (18540ms)\n2025-03-02 19:28:57.433 P00   INFO: expire command begin 2.54.2: --exec-id=223520-c7b6d892 --log-level-console=info --repo1-cipher-pass=<redacted> --repo1-cipher-type=aes-256-cbc --repo1-path=/mnt/pgbackrest_backups --repo1-retention-diff=2 --repo1-retention-full=2 --repo1-sftp-host=db.etcd.lan --repo1-sftp-host-key-hash-type=sha1 --repo1-sftp-host-user=postgres --repo1-sftp-private-key-file=/var/lib/postgresql/.ssh/id_ed25519 --repo1-sftp-public-key-file=/var/lib/postgresql/.ssh/id_ed25519.pub --repo1-type=sftp --stanza=testcluster\n2025-03-02 19:28:57.461 P00   INFO: expire command end: completed successfully (29ms)", "stdout_lines": ["2025-03-02 19:28:38.895 P00   INFO: backup command begin 2.54.2: --exec-id=223520-c7b6d892 --log-level-console=info --pg1-path=/var/lib/postgresql/15/data --pg1-port=5050 --process-max=4 --repo1-block --repo1-bundle --repo1-cipher-pass=<redacted> --repo1-cipher-type=aes-256-cbc --repo1-path=/mnt/pgbackrest_backups --repo1-retention-diff=2 --repo1-retention-full=2 --repo1-sftp-host=db.etcd.lan --repo1-sftp-host-key-hash-type=sha1 --repo1-sftp-host-user=postgres --repo1-sftp-private-key-file=/var/lib/postgresql/.ssh/id_ed25519 --repo1-sftp-public-key-file=/var/lib/postgresql/.ssh/id_ed25519.pub --repo1-type=sftp --stanza=testcluster --start-fast", "2025-03-02 19:28:39.604 P00   INFO: last backup label = 20250302-192424F, version = 2.54.2", "2025-03-02 19:28:39.604 P00   INFO: execute non-exclusive backup start: backup begins after the requested immediate checkpoint completes", "2025-03-02 19:28:52.381 P00   INFO: backup start archive = 000000010000000000000009, lsn = 0/9000028", "2025-03-02 19:28:52.381 P00   INFO: check archive for prior segment 000000010000000000000008", "2025-03-02 19:28:54.248 P00   INFO: execute non-exclusive backup stop and wait for all WAL segments to archive", "2025-03-02 19:28:54.624 P00   INFO: backup stop archive = 000000010000000000000009, lsn = 0/9000100", "2025-03-02 19:28:54.875 P00   INFO: check archive for segment(s) 000000010000000000000009:000000010000000000000009", "2025-03-02 19:28:55.530 P00   INFO: new backup label = 20250302-192424F_20250302-192839I", "2025-03-02 19:28:57.432 P00   INFO: incr backup size = 8.3KB, file total = 970", "2025-03-02 19:28:57.432 P00   INFO: backup command end: completed successfully (18540ms)", "2025-03-02 19:28:57.433 P00   INFO: expire command begin 2.54.2: --exec-id=223520-c7b6d892 --log-level-console=info --repo1-cipher-pass=<redacted> --repo1-cipher-type=aes-256-cbc --repo1-path=/mnt/pgbackrest_backups --repo1-retention-diff=2 --repo1-retention-full=2 --repo1-sftp-host=db.etcd.lan --repo1-sftp-host-key-hash-type=sha1 --repo1-sftp-host-user=postgres --repo1-sftp-private-key-file=/var/lib/postgresql/.ssh/id_ed25519 --repo1-sftp-public-key-file=/var/lib/postgresql/.ssh/id_ed25519.pub --repo1-type=sftp --stanza=testcluster", "2025-03-02 19:28:57.461 P00   INFO: expire command end: completed successfully (29ms)"]}
2025-03-02 19:28:57,529 p=1039826 u=digitd n=ansible INFO| TASK [Show info about backups] *******************************************************************************************************************************************************************************************************************
2025-03-02 19:28:58,165 p=1039826 u=digitd n=ansible INFO| changed: [db.master.lan] => {"changed": true, "cmd": ["sudo", "-u", "postgres", "pgbackrest", "info"], "delta": "0:00:00.197714", "end": "2025-03-02 19:28:58.106823", "msg": "", "rc": 0, "start": "2025-03-02 19:28:57.909109", "stderr": "", "stderr_lines": [], "stdout": "stanza: testcluster\n    status: ok\n    cipher: aes-256-cbc\n\n    db (current)\n        wal archive min/max (15): 000000010000000000000001/000000010000000000000009\n\n        full backup: 20250302-192424F\n            timestamp start/stop: 2025-03-02 19:24:24+03 / 2025-03-02 19:24:34+03\n            wal start/stop: 000000010000000000000004 / 000000010000000000000004\n            database size: 22MB, database backup size: 22MB\n            repo1: backup size: 3.0MB\n\n        incr backup: 20250302-192424F_20250302-192839I\n            timestamp start/stop: 2025-03-02 19:28:39+03 / 2025-03-02 19:28:54+03\n            wal start/stop: 000000010000000000000009 / 000000010000000000000009\n            database size: 22MB, database backup size: 8.3KB\n            repo1: backup size: 440B\n            backup reference total: 1 full", "stdout_lines": ["stanza: testcluster", "    status: ok", "    cipher: aes-256-cbc", "", "    db (current)", "        wal archive min/max (15): 000000010000000000000001/000000010000000000000009", "", "        full backup: 20250302-192424F", "            timestamp start/stop: 2025-03-02 19:24:24+03 / 2025-03-02 19:24:34+03", "            wal start/stop: 000000010000000000000004 / 000000010000000000000004", "            database size: 22MB, database backup size: 22MB", "            repo1: backup size: 3.0MB", "", "        incr backup: 20250302-192424F_20250302-192839I", "            timestamp start/stop: 2025-03-02 19:28:39+03 / 2025-03-02 19:28:54+03", "            wal start/stop: 000000010000000000000009 / 000000010000000000000009", "            database size: 22MB, database backup size: 8.3KB", "            repo1: backup size: 440B", "            backup reference total: 1 full"]}
2025-03-02 19:28:58,166 p=1039826 u=digitd n=ansible INFO| TASK [Print it] **********************************************************************************************************************************************************************************************************************************
2025-03-02 19:28:58,356 p=1039826 u=digitd n=ansible INFO| ok: [db.master.lan] => {
    "msg": [
        "stanza: testcluster",
        "    status: ok",
        "    cipher: aes-256-cbc",
        "",
        "    db (current)",
        "        wal archive min/max (15): 000000010000000000000001/000000010000000000000009",
        "",
        "        full backup: 20250302-192424F",
        "            timestamp start/stop: 2025-03-02 19:24:24+03 / 2025-03-02 19:24:34+03",
        "            wal start/stop: 000000010000000000000004 / 000000010000000000000004",
        "            database size: 22MB, database backup size: 22MB",
        "            repo1: backup size: 3.0MB",
        "",
        "        incr backup: 20250302-192424F_20250302-192839I",
        "            timestamp start/stop: 2025-03-02 19:28:39+03 / 2025-03-02 19:28:54+03",
        "            wal start/stop: 000000010000000000000009 / 000000010000000000000009",
        "            database size: 22MB, database backup size: 8.3KB",
        "            repo1: backup size: 440B",
        "            backup reference total: 1 full"
    ]
}
2025-03-02 19:28:58,523 p=1039826 u=digitd n=ansible INFO| TASK [Create cron job for full backup] ***********************************************************************************************************************************************************************************************************
2025-03-02 19:28:59,333 p=1039826 u=digitd n=ansible INFO| ok: [db.master.lan] => {"changed": false, "envs": [], "jobs": ["create DB backup", "full backup", "diff backup", "incr backup"]}
2025-03-02 19:28:59,334 p=1039826 u=digitd n=ansible INFO| TASK [Create cron job for diff backup] ***********************************************************************************************************************************************************************************************************
2025-03-02 19:29:01,581 p=1039826 u=digitd n=ansible INFO| ok: [db.master.lan] => {"changed": false, "envs": [], "jobs": ["create DB backup", "full backup", "diff backup", "incr backup"]}
2025-03-02 19:29:01,582 p=1039826 u=digitd n=ansible INFO| TASK [Create cron job for incr backup] ***********************************************************************************************************************************************************************************************************
2025-03-02 19:29:02,120 p=1039826 u=digitd n=ansible INFO| ok: [db.master.lan] => {"changed": false, "envs": [], "jobs": ["create DB backup", "full backup", "diff backup", "incr backup"]}
2025-03-02 19:29:02,121 p=1039826 u=digitd n=ansible INFO| PLAY RECAP ***************************************************************************************************************************************************************************************************************************************
2025-03-02 19:29:02,733 p=1039826 u=digitd n=ansible INFO| db.etcd.lan                : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-02 19:29:03,880 p=1039826 u=digitd n=ansible INFO| db.master.lan              : ok=13   changed=5    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-02 19:29:04,372 p=1039826 u=digitd n=ansible INFO| db.slave.lan               : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
